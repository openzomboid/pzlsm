# start-stop-restart
PZLSM предоставляет простой способ для запуска, остановки и перезапуска вашего сервера.

## Команды

### Запуск сервера
Сервер запускается в screen сессии, что позволяет работать серверу в фоновом режиме. После запуска сервера можно выходить из активного терминала и сервер продолжит работать.

    ./server.sh start

Во время первого запуска будет создан первый администратор с логином `admin`. Пароль будет взят из переменной `FIRST_RUN_ADMIN_PASSWORD`, указанной в файле конфигурации. Если в этой переменной не будет задан пароль, то его можно задать вручную. Нужно войти в активную [сессию screen](console.md) и ввести пароль в консоли. 

#### Аргументы

* `--no-screen|-n` - Запустить сервер в активном терминале без создания сессии screen. Это может понадобиться для отладки или ручного задания пароля от администратора по умолчанию.

      ./server.sh start --no-screen
      ./server.sh start -n

* `--wait|-w` - Дождаться запуска сервера. С этим параметром в терминал будет выведен ответ `SERVER STARTED`.

      ./server.sh start --wait
      ./server.sh start -w

* `--help` - Выводит помощь по команде запуска сервера.

      ./server.sh start --help

### Остановка сервера
Команда `stop` корректно завершает работу сервера.

#### Аргументы

* `--fixes|-f` - Удаляет манифест модов, что исправляет баг, не позволяющий нормально обновить моды. 

      ./server.sh stop --fixes
      ./server.sh stop -f

* `--no-tasks|-n` - Не делать бекапы и другие задачи после остановки сервера. Выполняется только остановка сервера. 

      ./server.sh stop --no-tasks
      ./server.sh stop -n

* `--help` - Выводит помощь по команде остановки сервера.

      ./server.sh stop --help

#### Команды
Если не указывать никаких подкоманд, то PZLSM остановит сервер через 5 минут после вызова команды. Будет выведено несколько серверных уведомлений об остановке сервера. Уведомления выведется за 5 минут, за одну минуту, за 10 секунд и за 5-1 секунд перед остановкой.

    ./server.sh stop

* `now` - Остановит сервер через 10 секунд после вызова.

      ./server.sh stop now
      ./server.sh stop now -f

* `kill` - Немедленно остановит сервер.

      ./server.sh stop -f kill
      ./server.sh stop kill


### Перезапуск сервера
Команда `restart` корректно перезапускает сервер.

#### Аргументы

* `--fixes|-f` - Удаляет манифест модов, что исправляет баг, не позволяющий нормально обновить моды.

      ./server.sh restart --fixes
      ./server.sh restart -f

* `--no-tasks|-n` - Не делать бекапы и другие задачи после остановки сервера. Выполняется только перезапуск сервера.

      ./server.sh stop --no-tasks
      ./server.sh stop -n

* `--wait|-w` - Дождаться запуска сервера. С этим параметром в терминал будет выведен ответ `SERVER STARTED`.

      ./server.sh restart --wait
      ./server.sh restart -w

* `--help` - Выводит помощь по команде перезапуска сервера.

      ./server.sh restart --help

#### Команды
Если не указывать никаких подкоманд, то PZLSM перезапустит сервер через 5 минут после вызова команды. Будет выведено несколько серверных уведомлений о перезапуске сервера. Уведомления выведется за 5 минут, за одну минуту, за 10 секунд и за 5-1 секунд перед рестартом.

    ./server.sh restart

* `now` - Перезапустит сервер через 10 секунд после вызова.

      ./server.sh restart now
      ./server.sh restart now -f

* `kill` - Немедленно перезапустит сервер.

      ./server.sh restart -f kill
      ./server.sh restart kill

## Бекап во время остановки сервера
PZLSM поддерживает возможность выполнения автоматических бекапов сервера во время каждой штатной остановки сервера. Штатной принимается остановка (и рестарт) без модификаторов `now` или `kill`. Т.е. остановки, которым предшествет пятиминутное ожидание с обратным отсчетом времени. Для включения опции нужно установить переменную `BACKUP_ON_STOP` в значение `"true"`.

    BACKUP_ON_STOP="true"
